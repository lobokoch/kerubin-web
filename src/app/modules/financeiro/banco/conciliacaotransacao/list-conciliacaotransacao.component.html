<!--
**********************************************************************************************
Code generated with MKL Plug-in version: 27.0.10
Code generated at time stamp: 2019-11-03T07:57:18.967
Copyright: Kerubin - logokoch@gmail.com

WARNING: DO NOT CHANGE THIS CODE BECAUSE THE CHANGES WILL BE LOST IN THE NEXT CODE GENERATION.
***********************************************************************************************
-->

<div class="container">
  <p-panel>
    <p-header>
      <div class="kb-form-panel-header">{{ getTranslation('cadastros.banco.conciliacaoTransacao') }}</div>
    </p-header>


    <div class="ui-g">

      <!-- Begin Filters -->
      <p-accordion class="ui-g-12">
        <p-accordionTab header="Filtros">

          <div class="ui-g">
            <div class="ui-g-12">


              <div class="ui-g-12">

                <div class="ui-g-12 ui-md-2 ui-fluid">
                  <label style="display: block">Intervalo de tempo</label>
                  <p-dropdown #conciliacaoTransacaoTrnDataIsBetweenOptions [options]="dateFilterIntervalDropdownItems"
                    [(ngModel)]="conciliacaoTransacaoTrnDataIsBetweenOptionsSelected" optionLabel="label"
                    (click)="conciliacaoTransacaoTrnDataIsBetweenOptionsOnClick(conciliacaoTransacaoTrnDataIsBetweenOptions)">
                  </p-dropdown>
                </div>

                <div class="ui-g-12 ui-md-2 ui-fluid">
                  <label class="label-r">Movimento de</label>
                  <p-calendar name="trnDataFrom" dateFormat="dd/mm/yy"
                    [(ngModel)]="conciliacaoTransacaoListFilter.trnDataFrom"></p-calendar>
                </div>

                <div class="ui-g-12 ui-md-2 ui-fluid">
                  <label class="label-l label-r">Até</label>
                  <p-calendar name="trnDataTo" dateFormat="dd/mm/yy"
                    [(ngModel)]="conciliacaoTransacaoListFilter.trnDataTo"></p-calendar>
                </div>

              </div>


              <div class="ui-g-12 ui-md-6 ui-fluid">
                <label class="label-r">Histórico</label>
                <p-autoComplete name="conciliacaoTransacaoTrnHistoricoAutoComplete"
                  placeholder="Digite para pesquisar..." [dropdown]="true"
                  [(ngModel)]="conciliacaoTransacaoListFilter.trnHistorico" [multiple]="true"
                  [suggestions]="conciliacaoTransacaoTrnHistoricoAutoCompleteSuggestions"
                  (completeMethod)="conciliacaoTransacaoTrnHistoricoAutoComplete($event)" field="trnHistorico">
                </p-autoComplete>
              </div>

              <div class="ui-g-12 ui-md-6 ui-fluid">
                <label class="label-r">Documento</label>
                <p-autoComplete name="conciliacaoTransacaoTrnDocumentoAutoComplete"
                  placeholder="Digite para pesquisar..." [dropdown]="true"
                  [(ngModel)]="conciliacaoTransacaoListFilter.trnDocumento" [multiple]="true"
                  [suggestions]="conciliacaoTransacaoTrnDocumentoAutoCompleteSuggestions"
                  (completeMethod)="conciliacaoTransacaoTrnDocumentoAutoComplete($event)" field="trnDocumento">
                </p-autoComplete>
              </div>

              <div class="ui-g-12 ui-md-3 ui-fluid">
                <label class="label-r">Crédito/Débito</label>
                <p-dropdown [options]="conciliacaoTransacaoTrnTipoOptions" placeholder="Selecione um item..."
                  [(ngModel)]="conciliacaoTransacaoListFilter.trnTipo"></p-dropdown>
              </div>


              <div class="ui-g-12 ui-fluid ui-md-9">

                <div class="ui-g-12 ui-md-2 ui-fluid">
                  <label class="label-r">Valores de</label>
                  <input pInputText type="text" name="trnValorFrom" currencyMask
                    [options]="{prefix: '', thousands: '.', decimal: ',', allowNegative: false}" placeholder="0,00"
                    [(ngModel)]="conciliacaoTransacaoListFilter.trnValorFrom" />
                </div>

                <div class="ui-g-12 ui-md-2 ui-fluid">
                  <label class="label-l label-r">até</label>
                  <input pInputText type="text" name="trnValorTo" currencyMask
                    [options]="{prefix: '', thousands: '.', decimal: ',', allowNegative: false}" placeholder="0,00"
                    [(ngModel)]="conciliacaoTransacaoListFilter.trnValorTo" />
                </div>

              </div>


              <div class="ui-g-12 ui-md-4 ui-fluid hidden">
                <label class="label-r hidden">Conciliação bancária</label>
                <input pInputText type="hidden" [(ngModel)]="conciliacaoTransacaoListFilter.conciliacaoBancariaId" />
              </div>

              <div class="ui-g-12 ui-md-4 ui-fluid">
                <label class="label-r">Situação</label>
                <p-dropdown [options]="conciliacaoTransacaoSituacaoConciliacaoTrnOptions"
                  placeholder="Selecione um item..."
                  [(ngModel)]="conciliacaoTransacaoListFilter.situacaoConciliacaoTrn"></p-dropdown>
              </div>


              <div class="ui-g-12 ui-md-2 ui-fluid">
                <label style="display: block" class="label-l label-r">Com erro</label>
                <p-inputSwitch [(ngModel)]="conciliacaoTransacaoListFilter.conciliadoComErroIsNotNull"></p-inputSwitch>
              </div>

              <div class="ui-g-12 ui-md-3 ui-fluid">
                <label style="display: block" class="label-l label-r">Com mais de um título</label>
                <p-inputSwitch [(ngModel)]="conciliadoComMaisDeUmTitulo"></p-inputSwitch>
              </div>

              <div class="ui-g-12 ui-md-3 ui-fluid">
                <label style="display: block" class="label-l label-r">Com mesmo título</label>
                <p-inputSwitch [(ngModel)]="conciliacaoTransacaoComMesmoTitulo"></p-inputSwitch>
              </div>


            </div>

            <div>
              <p-button label="Aplicar os filtros e pesquisar" icon="pi pi-search" iconPos="left"
                (click)="conciliacaoTransacaoFilterSearch()"></p-button>
            </div>
          </div>


        </p-accordionTab>
      </p-accordion>
      <!-- End Filters -->

      <!-- Begin GRID -->
      <div class="ui-g-12" name="data-grid">
        <p-table selectionMode="single" [loading]="loading" [responsive]="true" (onEditComplete)="onEditTransactionCellComplete($event)"
          [customSort]="true" [paginator]="true" [resizableColumns]="true" [value]="conciliacaoTransacaoListItems"
          [rows]="conciliacaoTransacaoListFilter.pageSize" [totalRecords]="conciliacaoTransacaoListTotalElements"
          [lazy]="true" (onLazyLoad)="conciliacaoTransacaoListOnLazyLoad($event)">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 7em" [pSortableColumn]="'trnData'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_trnData_grid') }}<p-sortIcon
                  [field]="'trnData'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'trnHistorico'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_trnHistorico_grid') }}<p-sortIcon
                  [field]="'trnHistorico'"></p-sortIcon>
              </th>
              <th style="width: 7em" [pSortableColumn]="'trnDocumento'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_trnDocumento_grid') }}<p-sortIcon
                  [field]="'trnDocumento'"></p-sortIcon>
              </th>
              <th style="width: 6em" [pSortableColumn]="'trnTipo'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_trnTipo_grid') }}<p-sortIcon
                  [field]="'trnTipo'"></p-sortIcon>
              </th>
              <th style="width: 8em" [pSortableColumn]="'trnValor'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_trnValor_grid') }}<p-sortIcon
                  [field]="'trnValor'"></p-sortIcon>
              </th>
              <th style="width: 8em" [pSortableColumn]="'situacaoConciliacaoTrn'">
                Situação<p-sortIcon
                  [field]="'situacaoConciliacaoTrn'"></p-sortIcon>
              </th>
              <th style="width: 5em" [pSortableColumn]="'tituloConciliadoId'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_tituloConciliadoId_grid') }}<p-sortIcon
                  [field]="'tituloConciliadoId'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'tituloConciliadoDesc'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_tituloConciliadoDesc_grid') }}<p-sortIcon
                  [field]="'tituloConciliadoDesc'"></p-sortIcon>
              </th>
              <th style="width: 5em" [pSortableColumn]="'conciliacaoTransacaoTitulos'">Qtde. títulos<p-sortIcon
                [field]="'conciliacaoTransacaoTitulos'"></p-sortIcon>
              </th>
              <th style="width: 8em" [pSortableColumn]="'planoConta'">Plano contas<p-sortIcon
                [field]="'conciliacaoTransacaoTitulos'"></p-sortIcon>
              </th>
              <th style="width: 7em" [pSortableColumn]="'dataConciliacao'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_dataConciliacao_grid') }}<p-sortIcon
                  [field]="'dataConciliacao'"></p-sortIcon>
              </th>

              <th style="width: 6.5em" [pSortableColumn]="'conciliadoMsg'">
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_conciliadoMsg_grid') }}<p-sortIcon
                  [field]="'conciliadoMsg'"></p-sortIcon>
              </th>
              <th style="width: 7em">Ações</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-conciliacaoTransacao>
            <tr [ngStyle]="calculateTransacaoRowStyle(conciliacaoTransacao)" [pSelectableRow]="conciliacaoTransacao">
              <td>
                {{conciliacaoTransacao?.trnData | date:'dd/MM/yyyy' }}
              </td>
              <td>
                {{ conciliacaoTransacao?.trnHistorico }}
              </td>
              <td>
                {{ conciliacaoTransacao?.trnDocumento }}
              </td>
              <td>
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_trnTipo' + '_' + conciliacaoTransacao?.trnTipo?.toLowerCase()) }}
              </td>
              <td class="kb-field-money">
                {{conciliacaoTransacao?.trnValor | currency:'BRL':'symbol':'1.2-2':'pt' }}
              </td>
              <td>
                {{ getTranslation('cadastros.banco.conciliacaoTransacao_situacaoConciliacaoTrn' + '_' + conciliacaoTransacao?.situacaoConciliacaoTrn?.toLowerCase()) }}
              </td>
              <td style="text-align: center">
                <i *ngIf="conciliacaoTransacao?.tituloConciliadoId" class="pi pi-info-circle" style="font-size: 2em"
                  [pTooltip]=conciliacaoTransacao?.tituloConciliadoId></i>
              </td>
              <td [pEditableColumn]="conciliacaoTransacao" pEditableColumnField="'tituloConciliadoDesc'">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <input pInputText type="text" [(ngModel)]="conciliacaoTransacao.tituloConciliadoDesc">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{ conciliacaoTransacao?.tituloConciliadoDesc }}
                    </ng-template>
                </p-cellEditor>
              </td>
              <td>
                {{conciliacaoTransacaoConciliacaoTransacaoTitulosAutoCompleteFieldConverter(conciliacaoTransacao?.conciliacaoTransacaoTitulos)}}
              </td>
              <td style="text-align: center" [pEditableColumn]="conciliacaoTransacao" pEditableColumnField="'planoContas'">
                <p-cellEditor>
                    <ng-template pTemplate="input">

                      <button (click)="onCellEditPlanoContas(conciliacaoTransacao)"
                      pButton icon="pi pi-pencil" pTooltip="Editar" tooltipPosition="top"></button>


                    </ng-template>
                    <ng-template pTemplate="output">
                      <i *ngIf="conciliacaoTransacao?.tituloPlanoContas" class="pi pi-info-circle" style="font-size: 2em"
                        [pTooltip]=planoContasAutoCompleteFieldConverter(conciliacaoTransacao?.tituloPlanoContas)></i>
                    </ng-template>
                </p-cellEditor>
              </td>
              <td>
                {{conciliacaoTransacao?.dataConciliacao | date:'dd/MM/yyyy' }}
              </td>

              <td style="text-align: center">
                <i *ngIf="conciliacaoTransacao?.conciliadoMsg" class="pi pi-info-circle" style="font-size: 2em"
                  [pTooltip]=conciliacaoTransacao?.conciliadoMsg></i>
              </td>
              <td class="kb-actions">
                <p-progressSpinner *ngIf="loadingSituacaoForPolling(conciliacaoTransacao)" [style]="{width: '20px', height: '20px'}" strokeWidth="4" animationDuration=".5s"></p-progressSpinner>

                <button *ngIf="!loadingSituacaoForPolling(conciliacaoTransacao)" (click)="onRowSelect(conciliacaoTransacao)"
                pButton icon="pi pi-pencil" pTooltip="Editar" tooltipPosition="top"></button>

                <button *ngIf="!loadingSituacaoForPolling(conciliacaoTransacao)" (click)="deleteConciliacaoTransacao(conciliacaoTransacao)"
                pButton icon="pi pi-trash" pTooltip="Excluir" tooltipPosition="top"></button>

              </td>
            </tr>
          </ng-template>


          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
              <td [attr.colspan]="12">
                Nenhum registro encontrado.
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="summary">
            Registros encontrados: {{conciliacaoTransacaoListTotalElements}}, total de páginas: {{conciliacaoTransacaoListTotalPages}}, registros por página: {{conciliacaoTransacaoListFilter.pageSize}}.
          </ng-template>

        </p-table>
      </div>
      <!-- End GRID -->

      <!--div class="ui-g-12 ui-md-2 ui-fluid">
        <a routerLink="/conciliacaotransacao/novo" pButton label="Novo registro"></a>
      </div-->
    </div>

  </p-panel>

</div>

<p-dialog header="Lista de títulos candidatos para conciliação" [(visible)]="displayDialog" [responsive]="true"
showEffect="fade" [modal]="true" [style]="{width: '800px'}">
  <div class="ui-g ui-fluid" style="margin-bottom: 5px">
    <strong>NOTA: Apenas o item marcado será considerado para conciliação. Você deve excluir os itens inválidos.</strong>
  </div>
  <div class="ui-g ui-fluid">
    <p-table [style]="{width: '770px'}" [columns]="cols" [value]="titulosDialog" dataKey="id"
      [(selection)]="selectedConciliacaoTransacaoTitulo"
      [scrollable]="true" [style]="{width:'800px'}">
      <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col *ngFor="let col of columns" [ngStyle]="getColStyle(col)">
        </colgroup>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns">
            {{col.header}}
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-titulo let-columns="columns">
        <tr [pSelectableRow]="titulo">
          <!--<td *ngFor="let col of columns | slice:0:6">
            {{rowData[col.field]}}
          </td-->
          <td>
              <p-tableRadioButton [value]="titulo"></p-tableRadioButton>
          </td>
          <td style="text-align: center">
            <i *ngIf="titulo?.tituloConciliadoId" class="pi pi-info-circle" style="font-size: 2em"
              [pTooltip]=titulo?.tituloConciliadoId></i>
          </td>
          <td>
            {{ titulo?.tituloConciliadoDesc }}
          </td>
          <td>
            {{titulo?.tituloConciliadoDataVen | date:'dd/MM/yyyy' }}
          </td>
          <td>
            {{titulo?.tituloConciliadoDataPag | date:'dd/MM/yyyy' }}
          </td>
          <td>
            {{ titulo?.tituloPlanoContas }}
          </td>
          <td>
            {{titulo?.dataConciliacao | date:'dd/MM/yyyy' }}
          </td>
          <td>
            {{ getTranslation('cadastros.banco.conciliacaoTransacaoTitulo_situacaoConciliacaoTrn' + '_' + titulo?.situacaoConciliacaoTrn?.toLowerCase()) }}
          </td>

          <td class="kb-actions">
            <button (click)="deleteConciliacaoTransacaoTitulo(titulo)" pButton icon="pi pi-trash"
              pTooltip="Excluir" tooltipPosition="top"></button>
          </td>
        </tr>
      </ng-template>

    </p-table>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa fa-close" (click)="calcelarDialog()" label="Cancelar"></button>
      <button type="button" pButton icon="fa fa-check" (click)="confirmarDialog()" label="OK"></button>
    </div>
  </p-footer>
</p-dialog>


<p-dialog header="Plano de contas" [(visible)]="displayDialogPlanoContas" [responsive]="true"
showEffect="fade" [modal]="true" [style]="{width: '600px'}" [contentStyle]="{'overflow':'visible'}">

  <div class="ui-g ui-fluid">
			<p-autoComplete
        p-autoComplete placeholder="Digite para pesquisar..." [dropdown]="true" [forceSelection]="true"
        [suggestions]="planoContasAutoCompleteSuggestions"
        (completeMethod)="planoContasAutoComplete($event)"
        (onClear)="planoContasAutoCompleteClear($event)"
        (onBlur)="planoContasAutoCompleteOnBlur($event)"
        [field]="planoContasAutoCompleteFieldConverter"
        #planoContas="ngModel" ngModel [(ngModel)]="conciliacaoTransacaoPlanoContas.tituloPlanoContas" name="tituloPlanoContas">
          <ng-template let-planoContas pTemplate="item">
            <div class="ui-helper-clearfix">{{ planoContasAutoCompleteFieldConverter(planoContas) }}</div>
          </ng-template>
			</p-autoComplete>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa fa-close" (click)="calcelarDialogPlanoContas()" label="Cancelar"></button>
      <button type="button" pButton icon="fa fa-check" (click)="confirmarDialogPlanoContas()" label="OK"></button>
    </div>
  </p-footer>
</p-dialog>
